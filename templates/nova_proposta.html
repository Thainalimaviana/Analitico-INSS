<link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}">
<style>
  .form-linha label {
    color: var(--cor-texto);
    font-weight: 600;
    font-size: 15px;
    margin-bottom: 6px;
    display: inline-block;
  }

  input[type="datetime-local"].barra-cpf,
  select.barra-cpf,
  input.barra-cpf,
  textarea.barra-cpf {
    background: var(--bg-input);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 10px;
    color: var(--cor-texto);
    font-size: 15px;
    padding: 10px 12px;
    width: 100%;
    transition: 0.3s ease;
  }

  input[type="datetime-local"].barra-cpf:focus,
  select.barra-cpf:focus,
  input.barra-cpf:focus,
  textarea.barra-cpf:focus {
    border-color: #00b848;
    box-shadow: 0 0 6px rgba(0, 255, 128, 0.4);
    background: rgba(255, 255, 255, 0.18);
  }

  select.barra-cpf:disabled,
  input.barra-cpf:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .form-linha.data-hora-linha {
    margin-top: 12px;
    margin-bottom: 25px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .form-linha.data-hora-linha label {
    margin-bottom: 6px;
    margin-left: 2px;
  }

  .button-group {
    margin-top: 10px;
  }

  @media (max-width: 600px) {
    .form-linha.data-hora-linha input {
      width: 100%;
    }
  }

  select.barra-cpf {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background: var(--bg-input);
    color: var(--cor-texto);
    font-weight: 500;
  }

  select.barra-cpf option {
    background: var(--gradiente-fim);
    color: var(--cor-texto);
  }

  select.barra-cpf {
    background-image: linear-gradient(45deg, transparent 50%, #00b848 50%),
      linear-gradient(135deg, #00b848 50%, transparent 50%);
    background-position: calc(100% - 18px) center, calc(100% - 12px) center;
    background-size: 6px 6px, 6px 6px;
    background-repeat: no-repeat;
  }

  select.barra-cpf:focus {
    outline: none;
    border-color: #00b848;
    box-shadow: 0 0 6px rgba(0, 255, 128, 0.4);
  }
</style>

{% extends "base.html" %}
{% block title %}Nova Proposta{% endblock %}

{% block content %}
<h1 class="titulo-tomorrow">Nova Proposta</h1>

{% if sucesso %}
<div class="msg-sucesso">
  <i class="fa fa-check-circle"></i> {{ sucesso }}
</div>
{% endif %}

<div class="container">
  <form method="POST">

    <div class="form-linha">
      <label>Fonte:</label>
      <select class="barra-cpf" name="fonte" required>
        <option value="">Selecione a Fonte</option>
        <option value="URA">URA</option>
        <option value="Disparo/Whatsapp">Disparo/Whatsapp</option>
        <option value="Disparo/SMS">Disparo/SMS</option>
        <option value="Indicação">Indicação</option>
        <option value="Discadora">Discadora</option>
        <option value="Tráfego">Tráfego</option>
      </select>
    </div>

    <div class="form-linha">
      <label>Banco:</label>
      <select class="barra-cpf" name="banco" id="banco" required>
        <option value="" disabled selected>Selecione o Banco</option>
        <option value="Qualibank">Qualibank</option>
        <option value="PAN">PAN</option>
        <option value="V8">V8</option>
        <option value="Amigoz">Amigoz</option>
        <option value="Facta-CLT">Facta - CLT</option>
        <option value="Facta-FGTS">Facta - FGTS</option>
        <option value="Tá Quitado">Tá Quitado</option>
        <option value="C6 INSS">C6 INSS</option>
        <option value="C6 CLT">C6 CLT</option>
      </select>
    </div>

    <div class="form-linha">
      <label>Senha Digitada:</label>
      <select class="barra-cpf" name="senha_digitada" id="senha_digitada" disabled required>
        <option value="">Selecione o Banco primeiro</option>
      </select>
    </div>

    <div class="form-linha">
      <label>Produto:</label>
      <select class="barra-cpf" name="produto" id="produto" disabled required>
        <option value="">Selecione a Senha primeiro</option>
      </select>
    </div>

    <div class="form-linha">
      <label>Tabela:</label>
      <select class="barra-cpf" name="tabela" id="tabela" disabled required>
        <option value="">Selecione o Produto primeiro</option>
      </select>
    </div>

    <div class="form-linha" style="display: flex; gap: 10px;">
      <div style="flex: 1;">
        <label>Valor da Parcela:</label>
        <input class="barra-cpf" type="number" step="0.01" name="valor_parcela" id="valor_parcela" placeholder="0,00">
      </div>

      <div style="flex: 1;">
        <label>Qtd. Parcelas:</label>
        <input class="barra-cpf" type="text" name="quantidade_parcelas" id="quantidade_parcelas" placeholder="0X"
          maxlength="3">
      </div>
    </div>

    <div class="form-linha">
      <input class="barra-cpf" type="text" name="nome_cliente" placeholder="Nome do Cliente" required>
      <input class="barra-cpf" type="text" name="cpf" placeholder="CPF" required>
    </div>

    <div class="form-linha">
      <input class="barra-cpf" type="text" name="telefone" placeholder="Telefone">
      <input class="barra-cpf" type="number" step="0.01" name="valor_equivalente" placeholder="Valor Equivalente">
      <input class="barra-cpf" type="number" step="0.01" name="valor_original" placeholder="Valor Original">
    </div>

    <div class="form-linha">
      <label>Observação:</label>
      <select name="observacao" class="barra-cpf">
        <option value="">Selecione a Observação</option>
        <option value="PAGO">PAGO</option>
        <option value="AGUARDANDO SALDO">AGUARDANDO SALDO</option>
        <option value="EM ANALISE">EM ANÁLISE</option>
        <option value="REPRESENTAÇÃO">REPRESENTAÇÃO</option>
        <option value="CANCELADO">CANCELADO</option>
        <option value="AGUARDANDO AVERBAÇÃO">AGUARDANDO AVERBAÇÃO</option>
      </select>
    </div>

    <div class="form-linha" id="linha-data-pagamento" style="display: none;">
      <label>Data CIP:</label>
      <input class="barra-cpf" type="text" name="data_pagamento_prevista" id="data_pagamento_prevista"
        placeholder="dd/mm/aaaa" maxlength="10">
    </div>

    <div class="form-linha" id="linha-motivo-cancelamento" style="display: none;">
      <label>Motivo do Cancelamento:</label>
      <select class="barra-cpf" name="motivo_cancelamento">
        <option value="">Selecione o motivo</option>
        <option value="Contrato liquidado/finalizado">Contrato liquidado/finalizado</option>
        <option value="Variação de valores">Variação de valores</option>
        <option value="Retenção">Retenção</option>
        <option value="Contrato em andamento">Contrato em andamento</option>
        <option value="Número divergente do contrato">Número divergente do contrato</option>
        <option value="Desistência">Desistência</option>
        <option value="Margem excedida">Margem excedida</option>
      </select>
    </div>

    <div class="form-linha data-hora-linha">
      <label>Data e Hora (opcional):</label>
      <input class="barra-cpf" type="datetime-local" name="data_manual" placeholder="Selecione data e hora">
    </div>

    <div class="button-group">
      <button type="submit" class="azul">
        <i class="fa fa-paper-plane"></i> Enviar Proposta
      </button>
    </div>

  </form>
</div>

<script>
  const dados = {
    "Qualibank": {
      senhas: ["thaina73@hotmail.com", "thainaviana@consigtechpromotora.com"],
      tabelas: [
        "000304 PORTABILIDADE + REFINANCIAMENTO 1,85% 96X SEM SEGURO MIN 6 MIL",
        "000305 PORTABILIDADE + REFINANCIAMENTO 1,83% 96X SEM SEGURO MIN 6 MIL",
        "000322 PORTABILIDADE + REFINANCIAMENTO 1,85% 96X SEM SEGURO BEN 32 MIN 6 MIL",
        "000306 PORTABILIDADE + REFINANCIAMENTO 1,80% 96X SEM SEGURO MIN 6 MIL",
        "QUALIBANKING INSS 000139 PORTABILIDADE 1,80%",
        "000323 PORTABILIDADE + REFINANCIAMENTO 1,83% 96X SEM SEGURO BEN 32 MIN 6 MIL",
        "QUALIBANKING INSS 000073 PORTABILIDADE 1,75%",
        "000307 PORTABILIDADE + REFINANCIAMENTO 1,78% 96X SEM SEGURO MIN 8 MIL",
        "000308 PORTABILIDADE + REFINANCIAMENTO 1,75% 96X SEM SEGURO MIN 8 MIL",
        "000324 PORTABILIDADE + REFINANCIAMENTO 1,80% 96X SEM SEGURO BEN 32 MIN 6 MIL",
        "000309 PORTABILIDADE + REFINANCIAMENTO 1,72% 96X SEM SEGURO MIN 8 MIL",
        "000325 PORTABILIDADE + REFINANCIAMENTO 1,78% 96X SEM SEGURO BEN 32 MIN 8 MIL 96X",
        "000074 PORTABILIDADE 1,70% A 1,74%",
        "000310 PORTABILIDADE + REFINANCIAMENTO 1,70% 96X SEM SEGURO MIN 8 MIL",
        "000330 PORTABILIDADE + REFINANCIAMENTO 1,75% 96X SEM SEGURO BEN 32 MIN 8 MIL",
        "000311 PORTABILIDADE + REFINANCIAMENTO 1,68% 96X SEM SEGURO MIN 8 MIL",
        "000326 PORTABILIDADE + REFINANCIAMENTO 1,72% 96X SEM SEGURO BEN 32 MIN 8 MIL",
        "000312 PORTABILIDADE + REFINANCIAMENTO 1,66% 96X SEM SEGURO MIN 8 MIL",
        "000316 NOVO SEM SEGURO 96X 1,85%", "000317 ENTRANTE SEM SEGURO 96X 1,85%",
        "000327 NOVO SEM SEGURO BEN 32 96X 1,85%", "000328 ENTRANTE SEM SEGURO BEN 32 96X 1,85%",
        "000332 AUMENTO SEM SEGURO BEN 32 96X 1,85%", "000234 AUMENTO SEM SEGURO 96X 1,85%"
      ]
    },

    "PAN": {
      senhas: ["30612588840_007824", "51077297890"],
      tabelas: ["6X", "12X", "18X", "24X", "30X", "36X", "48X"]
    },

    "Amigoz": {
      senhas: ["306.125.888-40", "458.491.998-45", "510.772.978-90", "501.879.218-30"],
      tabelas: [
        "36x c/ seguro", "24x c/ seguro", "18x c/ seguro",
        "36x s/ seguro", "24x s/ seguro", "18x s/ seguro"
      ]
    },

    "V8": {
      senhas: ["thaina737373@gmail.com"],
      tabelas: [
        "CLT ACELERA - COM SEGURO - 6X", "CLT ACELERA - COM SEGURO - 12x",
        "CLT ACELERA - COM SEGURO - 18x", "CLT ACELERA - COM SEGURO - 24x",
        "CLT ACELERA - SEM SEGURO - 6X", "CLT ACELERA - SEM SEGURO - 8x",
        "CLT ACELERA - SEM SEGURO - 10x", "CLT ACELERA - SEM SEGURO - 12x",
        "CLT ACELERA - SEM SEGURO - 18x", "CLT ACELERA - SEM SEGURO - 24x"
      ]
    },

    "Facta-CLT": {
      senhas: ["96552_biancafaria"],
      tabelas: ["63096 - NOVO GOLD	48x", "63096 - NOVO GOLD	42x", "63096 - NOVO GOLD	36x", "63096 - NOVO GOLD	30X", "63096 - NOVO GOLD	24X", "63096 - NOVO GOLD	20X",
        "63096 - NOVO GOLD	18X", "63096 - NOVO GOLD	15X", "63096 - NOVO GOLD	14x", "63096 - NOVO GOLD	12x", "63053 - NOVO SMART	48x", "63053 - NOVO SMART	42x", "63053 - NOVO SMART	36x",
        "63053 - NOVO SMART	30x", "63053 - NOVO SMART	24x", "63053 - NOVO SMART	20x", "63053 - NOVO SMART	18x", "63053 - NOVO SMART	15x", "63053 - NOVO SMART	14x", "63053 - NOVO SMART	12x"]
    },

    "Facta-FGTS": {
      senhas: ["96552_biancafaria"],
      tabelas: ["GOLD PREMIUM RB (61115)", "GOLD PREMIUM RB (62154)", "GOLD PREFERENCE RB (61379)", "GOLD PREFERENCE RB (62170)", "PLUS RB (62189)", "GOLD POWER RB (60119)", "LIGHT RB (62138)", "GOLD FIDELIZA RB (63703)"]
    },

    "Tá Quitado": {
      senhas: ["thaina73@hotmail.com"],
      tabelas: [
        "TQ FREE 2.0", "TQ LIGHT 2.0", "TQ FLEX 2.0",
        "TQ FLEX+ 2.0", "TQ TOTAL A", "TQ TOTAL B", "TQ MAX", "TQ MAX+"
      ]
    },

    "C6 INSS": {
      senhas: ["51077297890_000873"],
      tabelas: [
        "12", "24", "36", "48", "60", "72", "84", "96"
      ]
    },

    "C6 CLT": {
      senhas: [
        "51077297890_000873", "50187921830_000367", "30612588840_000873"],
      tabelas: [
        "48x - TAB: 800017 - c/ seguro 4 parcelas", "36x - TAB: 800017 - c/ seguro 4 parcelas",
        "48x - TAB: 800016 - c/ seguro 2 parcelas", "36x - TAB: 800016 - c/ seguro 2 parcelas",
        "24x - TAB: 800017 - c/ seguro 4 parcelas", "24x - TAB: 800016 - c/ seguro 2 parcelas",
        "18x - TAB: 800017 - c/ seguro 4 parcelas", "18x - TAB: 800016 - c/ seguro 2 parcelas",
        "12x - TAB: 800017 - c/ seguro 4 parcelas", "12x - TAB: 800017 - c/ seguro 2 parcelas",
        "6x - TAB: 800017 - c/ seguro 4 parcelas", "6x - TAB: 800016 - c/ seguro 2 parcelas",
        "48x - sem seguro", "36x - sem seguro", "24x - sem seguro", "18x - sem seguro",
        "12x - sem seguro", "6x - sem seguro"
      ]
    },
  };

  const produtos = [
    "NOVO",
    "PORT",
    "PORT + REFIN",
    "REFIN",
    "CARTÃO RMC",
    "CARTÃO RCC",
    "SAQUE COMPLEMENTAR",
    "CLT",
    "FGTS"
  ];

  const bancoSelect = document.getElementById("banco");
  const senhaSelect = document.getElementById("senha_digitada");
  const produtoSelect = document.getElementById("produto");
  const tabelaSelect = document.getElementById("tabela");

  bancoSelect.addEventListener("change", () => {
    const banco = bancoSelect.value;

    senhaSelect.disabled = false;
    produtoSelect.disabled = true;
    tabelaSelect.disabled = true;

    senhaSelect.innerHTML = '<option value="">Selecione a Senha</option>';
    produtoSelect.innerHTML = '<option value="">Selecione a Senha primeiro</option>';
    tabelaSelect.innerHTML = '<option value="">Selecione o Produto primeiro</option>';

    if (dados[banco]) {
      dados[banco].senhas.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        senhaSelect.appendChild(opt);
      });
    }
  });

  senhaSelect.addEventListener("change", () => {
    produtoSelect.disabled = false;
    tabelaSelect.disabled = true;

    produtoSelect.innerHTML = '<option value="">Selecione o Produto</option>';
    tabelaSelect.innerHTML = '<option value="">Selecione o Produto primeiro</option>';

    produtos.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p;
      opt.textContent = p;
      produtoSelect.appendChild(opt);
    });
  });

  produtoSelect.addEventListener("change", () => {
    const banco = bancoSelect.value;

    tabelaSelect.disabled = false;
    tabelaSelect.innerHTML = '<option value="">Selecione a Tabela</option>';

    if (dados[banco]) {
      dados[banco].tabelas.forEach(t => {
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        tabelaSelect.appendChild(opt);
      });
    }
  });

  const qtdParcelasInput = document.getElementById("quantidade_parcelas");

  qtdParcelasInput.addEventListener("input", () => {
    let valor = qtdParcelasInput.value.replace(/\D/g, "");

    if (!valor) {
      qtdParcelasInput.value = "";
      return;
    }

    let numero = Math.min(Math.max(parseInt(valor), 1), 99);
    qtdParcelasInput.value = numero;
  });

  const observacaoSelect = document.querySelector('select[name="observacao"]');
  const linhaDataPagamento = document.getElementById("linha-data-pagamento");
  const dataPagamentoInput = document.getElementById("data_pagamento_prevista");
  const linhaMotivoCancelamento = document.getElementById("linha-motivo-cancelamento");


  observacaoSelect.addEventListener("change", () => {
    const valor = observacaoSelect.value;

    if (valor === "AGUARDANDO SALDO") {
      linhaDataPagamento.style.display = "block";
      linhaMotivoCancelamento.style.display = "none";
    }
    else if (valor === "CANCELADO") {
      linhaDataPagamento.style.display = "none";
      linhaMotivoCancelamento.style.display = "block";
      dataPagamentoInput.value = "";
    }
    else {
      linhaDataPagamento.style.display = "none";
      linhaMotivoCancelamento.style.display = "none";
      dataPagamentoInput.value = "";
    }
  });

  dataPagamentoInput.addEventListener("input", () => {
    let valor = dataPagamentoInput.value.replace(/\D/g, "");

    if (valor.length > 8) valor = valor.slice(0, 8);

    if (valor.length >= 5) {
      valor = valor.replace(/^(\d{2})(\d{2})(\d+)/, "$1/$2/$3");
    } else if (valor.length >= 3) {
      valor = valor.replace(/^(\d{2})(\d+)/, "$1/$2");
    }

    dataPagamentoInput.value = valor;
  });
</script>
{% endblock %}